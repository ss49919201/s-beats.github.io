---
title: "go-linq触ってみた"
date: 2022-11-03T13:02:46+09:00
draft: false
comments: false
adsense: false
---

[go-linq](https://github.com/ahmetb/go-linq)というLINQ風のパッケージがあることを最近知りました。
私はGoでプログラマー人生をスタートしたこともあり、LINQが何たるかをあまり知らないのでそちらの調査ついでにちょっと触ってみようと思います。

## LINQ とは

> LINQとは、.NET Frameworkの仕様の一つで、様々な種類のデータ構造に対する操作や問い合わせなどを、プログラミング言語で書かれたプログラム中に一定の書式で直に記述することができるもの。

> SQLに似た構文で様々な形式のデータ構造に統一的にアクセスすることができる。

https://e-words.jp/w/LINQ.html

> 統合言語クエリ (LINQ) は、C# 言語への直接的なクエリ機能の統合に基づくテクノロジのセットの名前です。 これまでは、データに対するクエリは、コンパイル時の型チェックや IntelliSense のサポートがない単純な文字列として表現されてきました。 さらに、SQL データベース、XML ドキュメント、さまざまな Web サービスなど、各種データ ソースの異なるクエリ言語を学習する必要があります。

> クエリを記述する開発者にとって、最も目立つ LINQ の "統合言語" 部分は、クエリ式です。 クエリ式は、宣言型の "クエリ構文" で記述されます。 クエリ構文を使用することで、フィルター処理、並べ替え、グループ化などのデータ ソースに対する操作を、最小限のコードで実行できます。

https://learn.microsoft.com/ja-jp/dotnet/csharp/linq/?redirectedfrom=MSDN

- Language INtegrated Quuery (統合言語クエリ)
- .NET Frameworkが発祥
- SQLライクな構文で配列などの構造化されたデータを操作可能
- 文字列で他のサービスに渡す前にコンパイルされるので文法ミスなどを防げる？
- クエリ構文を使って、データ操作を少ないコードで表現できる
    - これは.NET Frameworkの話で、go-linqはメソッド構文になるはず

## go-linq 使用例

README.mdを参考に簡単なプログラムを書いてみました。
2022/11/03現在、メンテが2年近く止まっているっぽいですが、LINQの雰囲気を味わうのには良いかなと思います。

```go
import (
	"fmt"

	"github.com/ahmetb/go-linq/v3"
)

func main() {
	s := []string{"a", "b", "c"}

	linq.From(s).
		Select(func(v interface{}) interface{} {
			return v.(string) + "!"
		}).ToSlice(&s)

	fmt.Println(s) // [a! b! c!]
}
```

`From~`で構造体`Query`を初期化、メソッドを呼び出してデータを操作、`To~`で指定の型に変換しています。
データ操作は遅延実行される実装になっていて、`To~`の変換メソッドの中でそこに到達するまでに呼び出した(定義した？)操作が実行されるようです。
また操作対象のデータ実態を構造体のフィールドとして保持するのではなく、フィールドとして定義されている関数に閉じているのも興味深いなと思いました。(クロージャに関する知識が皆無なだけか...。)

個人的にはメソッドチェーンでデータ操作できるのはかなり好みです。
ただloを使う中で、ジェネリクスの安心感を知ってしまったので、`interface{}`まみれなのはちょっと抵抗感があります。
メソッドチェーンで操作できるジェネリクス対応パッケージがあれば是非使ってみたいですね。
