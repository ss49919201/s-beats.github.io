[{"categories":null,"contents":"レート制限のある処理の制御に役立つgolang.org/x/time/rateの存在を知りました。 繰り返し処理の中で AWS や Stripe のAPIを使いたい時などに採用できるのではないかと思い調査しました。\n   はじめにサンプルコード  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  func main() { ctx := context.Background() // 1秒間に0.5回(2秒間に1回)の処理を許可する \tl := rate.NewLimiter(0.5, 1) for i := 0; i \u0026lt; 10; i++ { if err := l.Wait(ctx); err != nil { panic(err) } println(i) } for i := 0; i \u0026lt; 10; i++ { if l.Allow() { println(i) } else { // 許可されなかったら少し待つ \tprintln(\u0026#34;not allowed\u0026#34;) time.Sleep(time.Second) } } }      Allow  即時実行可能かを返します。 内部実装としては引数を固定化してAllowNを呼び出しています。 呼び出されているAllowNは引数を固定化してreserveNを呼び出し戻り値の構造体Reservationのbool型のフィールドokの値を返します。 即時実行可能でなければスッと諦めたいときや、別の処理に移ってそちらを終えてからリトライしたい時などに使えそうでしょうか。\n   Wait  処理の回数に応じた待機時間だけブロックします。 内部実装としてはは引数を固定化してWaitNを呼び出しています。 context.ContextのDeadlineを考慮した待機時間を計算し、キャンセル時には内部で検知しエラーを返してくれます。 また、context.Contextがキャンセルされれば待機時間の途中であってもエラーを返します。 基本はWaitを使うことが多そうでしょうか。\n   Reserve  処理の実行可能フラグ、待機時間などを持った構造体を返します。 内部実装としてはは引数を固定化してReserveNを呼び出しています。 現時点の制御情報をもとに自前で自由にロジックを組みたい時に使えそうでしょうか。\n   reserveN  プライベートメソッドなので利用側から呼び出すことはないですが、大事な処理なので備忘も兼ねて超簡単にまとめておきます。\nreserveNは時刻、処理を実行したい回数、許容可能な待機時間を引数に受け取り構造体Reservationを返します。 メソッドのコメントにはreserveNはAllowN、WaitN、ReservationNでヘルパーメソッドであると記載されており、AllowN、WaitNにおいてはreserveNが返す構造体Reservationの値をもとロジックが組まれています。 そのことから構造体Reservationを生成しているこのメソッドの実装がかなり重要であることがわかります。\n   結び  rateパッケージは400行程度のソースコードで構成されています。 久しぶりにコードリーディングもしたかったので、全部読んで詳細にまとめることを試みましたが挫折しました。(正確には大方読んだけどまとめて記事ににおこす気力が湧かなかった)\n","date":"Nov 20","permalink":"https://s-beats.github.io/post/gorate%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9/","tags":null,"title":"【Go】rateパッケージの使い方"},{"categories":null,"contents":"go-linqというLINQ風のパッケージがあることを最近知りました。 私はGoでプログラマー人生をスタートしたこともあり、LINQが何たるかをあまり知らないのでそちらの調査ついでにちょっと触ってみようと思います。\n   LINQ とは   LINQとは、.NET Frameworkの仕様の一つで、様々な種類のデータ構造に対する操作や問い合わせなどを、プログラミング言語で書かれたプログラム中に一定の書式で直に記述することができるもの。\n  SQLに似た構文で様々な形式のデータ構造に統一的にアクセスすることができる。\n https://e-words.jp/w/LINQ.html\n 統合言語クエリ (LINQ) は、C# 言語への直接的なクエリ機能の統合に基づくテクノロジのセットの名前です。 これまでは、データに対するクエリは、コンパイル時の型チェックや IntelliSense のサポートがない単純な文字列として表現されてきました。 さらに、SQL データベース、XML ドキュメント、さまざまな Web サービスなど、各種データ ソースの異なるクエリ言語を学習する必要があります。\n  クエリを記述する開発者にとって、最も目立つ LINQ の \u0026ldquo;統合言語\u0026rdquo; 部分は、クエリ式です。 クエリ式は、宣言型の \u0026ldquo;クエリ構文\u0026rdquo; で記述されます。 クエリ構文を使用することで、フィルター処理、並べ替え、グループ化などのデータ ソースに対する操作を、最小限のコードで実行できます。\n https://learn.microsoft.com/ja-jp/dotnet/csharp/linq/?redirectedfrom=MSDN\n Language INtegrated Quuery (統合言語クエリ) .NET Frameworkが発祥 SQLライクな構文で配列などの構造化されたデータを操作可能 文字列で他のサービスに渡す前にコンパイルされるので文法ミスなどを防げる？ クエリ構文を使って、データ操作を少ないコードで表現できる  これは.NET Frameworkの話で、go-linqはメソッド構文になるはず       go-linq 使用例  README.mdを参考に簡単なプログラムを書いてみました。 2022/11/03現在、メンテが2年近く止まっているっぽいですが、LINQの雰囲気を味わうのには良いかなと思います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/ahmetb/go-linq/v3\u0026#34; ) func main() { s := []string{\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;} linq.From(s). Select(func(v interface{}) interface{} { return v.(string) + \u0026#34;!\u0026#34; }).ToSlice(\u0026amp;s) fmt.Println(s) // [a! b! c!] }   From~で構造体Queryを初期化、メソッドを呼び出してデータを操作、To~で指定の型に変換しています。 データ操作は遅延実行される実装になっていて、To~の変換メソッドの中でそこに到達するまでに呼び出した(定義した？)操作が実行されるようです。 また操作対象のデータ実態を構造体のフィールドとして保持するのではなく、フィールドとして定義されている関数に閉じているのも興味深いなと思いました。(クロージャに関する知識が皆無なだけか\u0026hellip;。)\n個人的にはメソッドチェーンでデータ操作できるのはかなり好みです。 ただ普段loを使う中で、ジェネリクスの安心感を知ってしまったので、interface{}まみれなのはちょっと抵抗感があります。 メソッドチェーンで操作できるジェネリクス対応パッケージがあれば是非使ってみたいですね。\n","date":"Nov 03","permalink":"https://s-beats.github.io/post/go-linq%E8%A7%A6%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F/","tags":null,"title":"【Go】go-linq触ってみた"},{"categories":null,"contents":"Postman v10 のリリースが発表されました。 https://blog.postman.com/announcing-postman-v10/\n面白そうなアップデートが結構あったので、内容を簡単にまとめてみます。\n   Postman CLI   Postman と同じランタイムで実行される。 Newman の基盤の上に乗っている。 https://blog.postman.com/introducing-the-postman-cli-to-automate-your-api-testing/  自動APIテストとかに使えるかも。\n   gRPC サポート   GraphQL に続き gRPC がサポートされた。 gRPC のURLをURLバーに打ち込むだけで、使えるメソッドをセットしてくれる。  サーバーリフレクションというらしいんだけど、サーバーに問い合わせて使えるメソッドを取得しているのかな？   https://blog.postman.com/postman-v10-and-grpc-what-you-can-do/  重い腰を上げて gRPC を始める機が熟したか\u0026hellip;。\n   パートナーワークスペース   チーム外のメンバーを招待できるようになった。 権限を絞ったり、特定のワークスペースにのみアクセスを許可するなどの制御ができる。  これらを管理する新しいロールができた。   https://blog.postman.com/introducing-partner-workspaces/  「チームに入れるとコストが気になるけど、同じワークスペースは使ってほしい業務委託メンバーが複数人いる」みたいなケースで嬉しいかな？\n   API Security   セキュリティルールに違反してしないかをチェックできる。 定義だけじゃなくてリクエストもチェックしてくれる。 Postman が提供してくれるルールをON/OFFして設定する。 https://blog.postman.com/introducing-api-security-in-postman-v10/  API 定義のレビューってミスを見逃しがちな気がするから良いかも。 というかそもそも脆弱な定義とか全然知らないからこれを使って学んでいきたい。\n   API Governance   組織の API のルールに違反してしないかをチェックできる。 重大度とかも設定できる。 Postman rule library に含まれる違反の場合は影響や修正方法へのリンクを掲示してくれる。 https://blog.postman.com/api-governance-with-postman-v10/  スタイルガイドがきちんとある組織ならかなり活きそう。 スタイルガイド作るのが大変そうだけど。\n   あまり理解できなかった   API Builder の改善 Private API Network  使ったことなくてイメージ付きませんでした。\n","date":"Sep 10","permalink":"https://s-beats.github.io/post/postman-v10-%E3%81%8C%E7%99%BA%E8%A1%A8%E3%81%95%E3%82%8C%E3%81%9F/","tags":null,"title":"Postman v10 が発表された"},{"categories":null,"contents":"今回のGW期間で作ったツールを雑に列挙する。\n   idgen  ダミーのUUIDとかULID欲しいなーって時にコマンド打ち込むだけで出力してくれるツールを作った。\n個人開発の中で結構使ってて気に入っている。\nいずれはVersion指定とかもできたらいいかなと思っている。\nhttps://github.com/s-beats/idgen\n   ssmparam  https://github.com/aws/aws-sdk-go の SSM のAPIの薄いラッパーを作った。\n~Inputと~Outputの形の構造体を扱うのが面倒な時があったのがモチベーションである。\nユースケースを絞りすぎている感はあるけど割と気に入っている。 簡素な作りだけど開発自体は楽しかった。\nhttps://github.com/s-beats/ssmparam\n   まとめ  やっぱり開発って楽しい。\n最近はWEBアプリとかを作るよりも便利ツールやライブラリを作ることに喜びを感じます。\n","date":"May 07","permalink":"https://s-beats.github.io/post/gw%E3%81%AB%E4%BD%9C%E3%81%A3%E3%81%9F%E3%83%84%E3%83%BC%E3%83%AB/","tags":null,"title":"GWに作ったツール"},{"categories":null,"contents":"何回も調べている気がするのでメモしておく。\nDosはDenial-of-service attackの略なので、サービスを妨害する攻撃を指す。 DDosはDistributed Denial-of-service attackの略なので、分散された攻撃元(システムかマシンか何かと解釈)からサービスを妨害する攻撃を指す。\n   参考   https://ja.wikipedia.org/wiki/DoS%E6%94%BB%E6%92%83  ","date":"Apr 10","permalink":"https://s-beats.github.io/post/dos%E3%81%A8ddos%E3%81%AE%E9%81%95%E3%81%84/","tags":null,"title":"DosとDDosの違い"},{"categories":null,"contents":"   パスワードクラックとは？   パスワードを破ること オンライン攻撃→実際にログインを試みる オフライン攻撃→パスワードが書いてあるファイルを入手して、ローカルで解読する     手法   辞書  よく使われるワードがたくさん記録されたファイルを使って、順番に試す   総当たり  文字数、文字の種類から考えうるパターンを試す   レインボーテーブル  ハッシュ値から元の文字列への逆引き表を使って解読する    ","date":"Mar 30","permalink":"https://s-beats.github.io/post/%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%82%AF%E3%83%A9%E3%83%83%E3%82%AF/","tags":null,"title":"パスワードクラック"},{"categories":null,"contents":"   NOTICEとは  サイバー攻撃に利用されるおそれのあるIoT機器の調査をして、 該当する機器の利用者へ注意喚起を行う取り組みを指す。\n総務省、国立研究開発法人情報通信機構（NICT）及びISPが連携して、実施される。\n   取り組みフロー  実施される取り組みの大まかなフローは以下である。\n NICTがIoT機器（ルータ、ウェブカメラ等）に、容易に推測されるパスワードを入力して調査 調査結果をISPに情報提供 ISPから利用者に注意喚起（メール、郵送等） 利用者がNOTICEサポートセンター（総務省が設置）に問い合わせユーザサポートを受けて、設定の変更等の適切な対策を実施（パスワード設定、ファームウェア更新等）     まとめ   NICTが攻撃に利用されるIoT機器の調査し、ISPを通じて注意喚起 利用者がユーザサポートに問い合わせ、設定を変更     参考   https://notice.go.jp/  ","date":"Jan 03","permalink":"https://s-beats.github.io/post/notice/","tags":null,"title":"NOTICE"},{"categories":null,"contents":"ごっちゃにして解釈されがちだし、自分もしていたのでまとめる。\n   二要素認証とは  認証に二つの要素を使用する方式を指す。 このとき選択する要素は、知識、所有、生体の三つのうち二つである。\n   二段階認証  認証の成立に二つの段階を要する方式を指す。\n   違い  二要素認証 = 二段階認証 ではない！ パスワード認証成立→秘密の質問認証成立→認証成立といった場合は、二段階認証ではあるが知識要素しか用いていないため、二要素認証にはならない。 段階が一つでも、一度に二つの要素の認証を行う場合は、二要素認証となる。\n認証時の段階の数を示すのが○段階認証であり、 認証に用いる要素数を示すのが○要素認証となる。\n","date":"Jan 02","permalink":"https://s-beats.github.io/post/%E4%BA%8C%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E3%81%A8%E4%BA%8C%E6%AE%B5%E9%9A%8E%E8%AA%8D%E8%A8%BC/","tags":null,"title":"二要素認証と二段階認証"},{"categories":null,"contents":"業務でRDSを使うことになったので再復習がてら雑なメモを残す。\n   概要   マネージドRDBサービスである。 バックアップ、ハードのメンテナンス、障害時の復旧など面倒見てくれる。 エンジンは複数種類用意されている。     ストレージ   保存用ストレージにはEBSを使う。  汎用SSD、プロビジョンドIOPS SSD、マグネティックの三種から選択する。   高いIOPSが求められる際はプロビジョンドIOPS SSDを使う。 ストレージ拡張はダウンタイムなしで可能だが、拡張中は若干パフォーマンスが落ちる。     マルチAZ   二つのAZにDBインスタンスを配置可能である。 障害発生時やメンテナンスのダウンタイムを短縮して高い可用性を保てる。 片方のAZにはマスターDBインスタンス、もう片方にはスタンバイDBインスタンスが配置される。 マスターとスタンバイの同期レプリケーション(リアルタイムでの複製作成)により冗長化される。 マスターへの更新時に、同期レプリケーションが実行されて更新完了となる。 若干の遅延はあるが、数ms程度である。 フェイルオーバーが発生した際は、RDSのFQDNのDNSレコードがスタンバイ側IPに差し向けられる。  アプリケーション側でIPのキャッシュを持っている場合は、一時的に接続できなくなる。       リードレプリカ   参照専用のDBインスタンスである。 マスターのメンテナンス時も、参照は止めないという運用が可能となる。 マスターへの負荷を抑えられる。 マスターとのデータ同期は非同期レプリケーション方式で実行される。 書き込み時にパフォーマンスへの影響はないが、反映まで若干のタイムラグがある。     バックアップ   自動バックアップ可能である。  1日1回自動でDBスナップショットを取得する。 保持期間は最大35日である。 スナップショットを選択して新しいDB作成可能である。 稼働中のインスタンスにバックアップデータを置き換えることはできない。(新しく作るしかない)   手動スナップショットも可能である。  1リージョンあたり100個までという制限がある。 シングルAZの場合、短時間のI/O中断時間がある。(自動バックアップも) マルチAZの場合は、スタンバイからスナップショットを取るのでマスターへの影響はない。(I/Oのダウンタイムはない)       リストア   スナップショットを選んで新しいインスタンスを作成する。     ポイントインタイムリカバリー   直近5分前から最大35日前までの任意のタイミングの状態のDBインスタンスを作成可能である。 最大日数は自動バックアップの期間に準ずる。  自動バックアップ有効の場合のみポイントインタイムリカバリ可能である。       ネットワーク   VPC内に配置可能で、インターネット非公開にできる。 ほかのサービスからの通信はエンジンが提供するSSLを使った暗号化で守られる。     暗号化   暗号化有効にすることで、ストレージ 、スナップショット、ログなどを暗号化して保存できる。 途中から有効にすることはできない。 スナップショット暗号化コピーを作って、そのコピーからDBインスタンスを作成することで既存のデータを暗号化できる。     Aurora   AWS独自のエンジンで、ハイパフォーマンスである。 MySQL互換のエディション、PostgreSQL互換のエディションがある。     構成   インスタンスを作成すると、Auroraクラスタが作成される。 クラスタは、DBインスタンス、クラスタボリューム(ストレージ)で構成される。 ボリュームはSSDベースである。 クラスタボリュームは、単一リージョン内の3つのAZにあるそれぞれ2つのコピーで構成される。  自動で同期される。 自動で64TBまで拡張される。       レプリカ   マスタのマルチAZ構成はない。 クラスタ内のリードレプリカが、プライマリインスタンスに昇格することでフェイルオーバーを実現する。     エンドポイント   プライマリインスタンスへのエンドポイントはクラスタエンドポイントとなる。 リードレプリカへのエンドポイントは読み取りエンドポイントとなる。  複数のレプリカインスタンスがある場合は自動で負荷分散される。   インスタンスごとのエンドポイントはインスタンスエンドポイントとなる。 インスタンスエンドポイントをグルーピングして、カスタムエンドポイントを作成することも可能である。  ","date":"Dec 18","permalink":"https://s-beats.github.io/post/rds%E5%BE%A9%E7%BF%92%E3%83%A1%E3%83%A2/","tags":null,"title":"RDS復習メモ"},{"categories":null,"contents":"","date":"Jan 01","permalink":"https://s-beats.github.io/articles/","tags":null,"title":"Articles"}]